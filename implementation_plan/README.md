# 実装計画：削除データ表示制御と復元機能

このディレクトリには、重複データ管理システムに削除データ表示制御と復元機能を追加するための実装計画が格納されています。

## ドキュメント構成

### [01_requirements_definition.md](01_requirements_definition.md)
**要件定義書**

提示された要件を整理・分析し、具体的な機能仕様として定義したドキュメントです。

**主要な要件:**
- レコード数表示の改善（有効/削除済み件数の併記）
- 削除済みデータ表示制御（チェックボックス）
- 復元機能の追加
- 効率的な運用フローの確立

### [02_implementation_plan.md](02_implementation_plan.md)
**実装計画書**

要件を実現するための具体的な実装手順と技術仕様をまとめたドキュメントです。

**実装フェーズ:**
1. **フェーズ1**: 削除済みデータ表示制御機能
2. **フェーズ2**: 復元機能の実装  
3. **フェーズ3**: UI/UX の改善

## 要件概要

### 現在の課題
- 削除済み（`receptmoddt IS NOT NULL`）と有効データが混在表示
- レコード数表示が削除状況を考慮していない
- 削除済みデータの復元手段がない
- 効率的なデータ整理ワークフローが未確立

### 解決策
1. **削除済み表示制御**
   - 「削除済みデータを表示する」チェックボックス
   - デフォルト：削除済み非表示

2. **レコード数表示改善**
   ```
   現在：全レコード (155,081件)
   改善後：全レコード: 155,081件 (有効: 142,356件 / 削除済み: 12,725件)
   ```

3. **復元機能**
   - 削除済みデータの`receptmoddt`をNULLに戻す
   - 削除/復元ボタンの動的表示

4. **運用フロー最適化**
   ```
   ①削除済み非表示（デフォルト）→ ②重複検出 → ③絞り込み → ④削除 → ①に戻る
   ```

## 技術的なポイント

### バックエンド
- **データサービス拡張**: `FilterRequest`に`include_deleted`フィールド追加
- **統計情報API**: 有効/削除済み件数を取得
- **復元サービス**: 削除済みデータの`receptmoddt`をNULL化

### フロントエンド
- **状態管理**: 削除済み表示フラグの管理
- **動的UI**: 選択データの状態に応じた操作ボタン表示
- **視覚的識別**: 削除済みデータの薄グレー表示

### データベース
- **クエリ最適化**: 削除状態フィルターの効率化
- **インデックス**: `receptmoddt`関連インデックスの確認
- **論理削除維持**: 既存の削除仕組みを維持

## 実装時の注意事項

### 互換性
- 既存APIの後方互換性を維持
- 重複検出ロジックは削除済み除外を継続
- データベース構造の変更なし

### パフォーマンス
- 削除済みフィルター適用でも2秒以内のレスポンス
- 大量削除済みデータでもスクロール性能維持
- 統計情報取得の効率化

### ユーザビリティ
- デフォルト状態で運用効率を重視
- 削除/復元操作の明確な区別
- 確認ダイアログによる操作ミス防止

## 影響範囲

### 修正ファイル
**バックエンド**
- `app/services/data_service.py`
- `app/services/delete_service.py` 
- `app/api/operations.py`
- `app/models/request_models.py`
- `app/models/response_models.py`

**フロントエンド**
- `app/templates/index.html`
- `app/static/js/app.js`
- `app/static/js/delete-manager.js`
- `app/static/css/style.css`

### 新規ファイル
- `app/services/restore_service.py` (必要に応じて)

## 次のステップ

このドキュメントを基に、以下の順序で実装を進めることを推奨します：

1. **要件の最終確認** - ステークホルダーとの要件確認
2. **フェーズ1実装** - 削除済み表示制御機能
3. **テスト・検証** - 機能テストと性能テスト
4. **フェーズ2実装** - 復元機能
5. **総合テスト** - 統合テストと運用テスト
6. **リリース** - 段階的リリースと監視

各フェーズの詳細な実装手順は、実装計画書を参照してください。
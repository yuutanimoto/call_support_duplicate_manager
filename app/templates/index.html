<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>重複データ管理システム</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav class="main-navigation">
        <div class="nav-container">
            <a href="/" class="nav-brand">重複データ管理システム</a>
            <button class="nav-toggle" aria-label="メニューを開く">☰</button>
            <ul class="nav-links">
                <li><a href="/">データ管理</a></li>
                <li><a href="/system-diagram">システム構成図</a></li>
                <li><a href="/user-manual">ユーザーマニュアル</a></li>
            </ul>
        </div>
    </nav>

    <div class="breadcrumbs"></div>

    <div id="app">
        <!-- ヘッダー -->
        <header class="header">
            <h1>重複データ管理システム</h1>
            <div class="header-controls">
                <button id="table-settings-btn" class="btn btn-secondary">
                    テーブル設定
                </button>
                <button id="reset-settings-btn" class="btn btn-outline">
                    デフォルト復元
                </button>
            </div>
        </header>

        <!-- 検索・フィルターエリア（左サイドバー） -->
        <section class="filter-section">
            <div class="filter-row">
                <div class="form-group">
                    <label for="content-keyword">受付内容:</label>
                    <input type="text" id="content-keyword" placeholder="受付内容で検索">
                </div>
                <div class="form-group">
                    <label for="status-keyword">対応状況:</label>
                    <input type="text" id="status-keyword" placeholder="対応状況で検索">
                </div>
                <div class="form-group">
                    <label for="progress">進捗:</label>
                    <select id="progress">
                        <option value="">全て</option>
                    </select>
                </div>
            </div>
            <div class="filter-row">
                <div class="form-group">
                    <label for="system-type">システム種別:</label>
                    <select id="system-type">
                        <option value="">全て</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="product">製品:</label>
                    <select id="product">
                        <option value="">全て</option>
                    </select>
                </div>
            </div>
            <div class="filter-row">
                <div class="form-group">
                    <label for="date-from">受付日時（開始）:</label>
                    <input type="date" id="date-from">
                </div>
                <div class="form-group">
                    <label for="date-to">受付日時（終了）:</label>
                    <input type="date" id="date-to">
                </div>
            </div>
            <div class="filter-row">
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="include-deleted-checkbox">
                        削除済みデータを表示する
                    </label>
                </div>
            </div>
            <div class="filter-actions">
                <button id="search-filter-execute-btn" class="btn btn-primary">検索・フィルター実行</button>
                <button id="filter-clear-btn" class="btn btn-outline">クリア</button>
            </div>

            <!-- 重複データ検出セクション -->
            <div class="duplicate-detection-section">
                <h3>重複データ検出</h3>
                <div class="form-group">
                    <label for="duplicate-type-select">検出タイプ:</label>
                    <select id="duplicate-type-select">
                        <option value="exact">完全一致</option>
                        <option value="content">受付内容</option>
                        <option value="status">対応状況</option>
                    </select>
                </div>
                <button id="detect-duplicates-btn" class="btn btn-warning">重複検出実行</button>
            </div>
        </section>

        <!-- メインコンテンツエリア（右側） -->
        <div class="main-content">
            <!-- 統計情報パネル -->
            <div class="statistics-panel">
                <!-- モード表示エリア -->
                <div id="mode-indicator" class="mode-indicator normal-mode">
                    <span id="mode-label" class="mode-label">📊 通常データ表示</span>
                    <div class="mode-actions">
                        <button id="back-to-normal" class="back-to-normal hidden">通常表示に戻る</button>
                        <span id="loading-indicator" class="loading-indicator hidden">読み込み中...</span>
                    </div>
                </div>
                
                <!-- 統計情報表示 -->
                <div id="statistics-display" class="statistics-display">
                    <!-- 通常モード統計 -->
                    <div id="normal-stats" class="normal-stats">
                        全レコード: <span id="total-all">0</span>件 
                        (有効: <span id="total-active" class="active-count">0</span>件 / 削除済み: <span id="total-deleted" class="deleted-count">0</span>件)
                        | 表示中: <span id="current-count">0</span>件 | 選択中: <span id="selected-count">0</span>件
                    </div>
                    
                    <!-- 重複モード統計 -->
                    <div id="duplicate-stats" class="duplicate-stats hidden">
                        重複検出結果: <span id="duplicate-groups">0</span>グループ、<span id="duplicate-total">0</span>件
                        | 表示中: <span id="duplicate-displayed">0</span>件 | 選択中: <span id="duplicate-selected">0</span>件
                    </div>
                </div>
            </div>

            <!-- 操作パネル -->
            <section class="delete-section">
                <div class="delete-actions">
                    <button id="select-all-btn" class="btn btn-secondary">すべて選択</button>
                    <button id="deselect-all-btn" class="btn btn-secondary">すべて解除</button>
                    
                    <!-- 削除ボタン（有効データ選択時） -->
                    <button id="delete-selected-btn" class="btn btn-danger" style="display: none;">
                        削除 (<span id="delete-count">0</span>)
                    </button>
                    
                    <!-- 復元ボタン（削除済みデータ選択時） -->
                    <button id="restore-selected-btn" class="btn btn-success" style="display: none;">
                        復元 (<span id="restore-count">0</span>)
                    </button>

                    <span style="margin-left: auto;">
                        表示: <select id="page-size">
                            <option value="50">50</option>
                            <option value="100" selected>100</option>
                            <option value="200">200</option>
                            <option value="300">300</option>
                            <option value="500">500</option>
                        </select>件 | <span id="data-range">0-0件目</span>
                    </span>
                </div>
            </section>

            <!-- データテーブルエリア -->
            <section class="table-section">
                <div class="table-container" id="table-container">
                    <table id="data-table" class="data-table">
                        <thead>
                            <tr id="table-header">
                                <th class="fixed-column">
                                    <input type="checkbox" id="header-checkbox">
                                </th>
                                <!-- 動的に生成される列ヘッダー -->
                            </tr>
                        </thead>
                        <tbody id="table-body">
                            <!-- 動的に生成されるデータ行 -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- （右下の重複検出は削除） -->
        </div>
    </div>

    <!-- テーブル設定ダイアログ -->
    <div id="table-settings-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>テーブル表示設定</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>表示列設定</h4>
                    <div id="column-settings" class="column-settings">
                        <!-- 動的に生成される列設定 -->
                    </div>
                </div>
                <div class="settings-section">
                    <h4>表示・ページ設定</h4>
                    <div class="form-group">
                        <label for="modal-page-size">1ページ表示件数:</label>
                        <select id="modal-page-size">
                            <option value="50">50件</option>
                            <option value="100">100件</option>
                            <option value="200">200件</option>
                            <option value="300">300件</option>
                            <option value="500">500件</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="auto-scroll-enabled">
                            自動スクロール有効
                        </label>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>ソート設定</h4>
                    
                    <!-- タブ切り替え -->
                    <div class="sort-tabs">
                        <button class="tab-button active" data-tab="search">検索・フィルター用</button>
                        <button class="tab-button" data-tab="duplicate">重複検出用</button>
                    </div>
                    
                    <!-- 検索・フィルター用ソート設定 -->
                    <div id="search-sort-panel" class="sort-panel active">
                        <h5>検索・フィルター実行時のソート</h5>
                        
                        <div class="sort-priority-group">
                            <label>優先度1:</label>
                            <select id="search-sort-col-1" class="sort-column-select">
                                <option value="">なし</option>
                            </select>
                            <select id="search-sort-dir-1" class="sort-direction-select">
                                <option value="asc">昇順</option>
                                <option value="desc">降順</option>
                            </select>
                        </div>
                        
                        <div class="sort-priority-group">
                            <label>優先度2:</label>
                            <select id="search-sort-col-2" class="sort-column-select">
                                <option value="">なし</option>
                            </select>
                            <select id="search-sort-dir-2" class="sort-direction-select">
                                <option value="asc">昇順</option>
                                <option value="desc">降順</option>
                            </select>
                        </div>
                        
                        <div class="sort-priority-group">
                            <label>優先度3:</label>
                            <select id="search-sort-col-3" class="sort-column-select">
                                <option value="">なし</option>
                            </select>
                            <select id="search-sort-dir-3" class="sort-direction-select">
                                <option value="asc">昇順</option>
                                <option value="desc">降順</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 重複検出用ソート設定 -->
                    <div id="duplicate-sort-panel" class="sort-panel" style="display:none;">
                        <h5>重複検出実行時のソート</h5>
                        
                        <!-- 検出タイプ選択 -->
                        <div class="duplicate-type-selector">
                            <label>検出タイプ:</label>
                            <select id="duplicate-sort-type">
                                <option value="exact">完全一致</option>
                                <option value="content">受付内容</option>
                                <option value="status">対応状況</option>
                            </select>
                        </div>
                        
                        <!-- 各タイプのソート設定 -->
                        <div id="duplicate-sort-settings">
                            <div class="sort-priority-group">
                                <label>優先度1:</label>
                                <select id="dup-sort-col-1" class="sort-column-select">
                                    <option value="">なし</option>
                                </select>
                                <select id="dup-sort-dir-1" class="sort-direction-select">
                                    <option value="asc">昇順</option>
                                    <option value="desc">降順</option>
                                </select>
                            </div>
                            
                            <div class="sort-priority-group">
                                <label>優先度2:</label>
                                <select id="dup-sort-col-2" class="sort-column-select">
                                    <option value="">なし</option>
                                </select>
                                <select id="dup-sort-dir-2" class="sort-direction-select">
                                    <option value="asc">昇順</option>
                                    <option value="desc">降順</option>
                                </select>
                            </div>
                            
                            <div class="sort-priority-group">
                                <label>優先度3:</label>
                                <select id="dup-sort-col-3" class="sort-column-select">
                                    <option value="">なし</option>
                                </select>
                                <select id="dup-sort-dir-3" class="sort-direction-select">
                                    <option value="asc">昇順</option>
                                    <option value="desc">降順</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="apply-settings-btn" class="btn btn-primary">適用</button>
                <button id="cancel-settings-btn" class="btn btn-secondary">キャンセル</button>
                <button id="reset-to-default-btn" class="btn btn-outline">デフォルトに戻す</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="/static/js/navigation.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="/static/js/table-manager.js"></script>
    <script src="/static/js/filter-manager.js"></script>
    <script src="/static/js/delete-manager.js"></script>
</body>
</html>